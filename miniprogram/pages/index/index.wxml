<!--pages/index/index.wxml-->
<view class="container">
  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-card">
    <view class="stats-item">
      <text class="stats-num">{{stats.total}}</text>
      <text class="stats-label">è´§ç‰©æ€»æ•°</text>
    </view>
    <view class="stats-item">
      <text class="stats-num text-success">{{stats.inStock}}</text>
      <text class="stats-label">åº“å­˜å……è¶³</text>
    </view>
    <view class="stats-item">
      <text class="stats-num text-warning">{{stats.lowStock}}</text>
      <text class="stats-label">åº“å­˜ä¸è¶³</text>
    </view>
  </view>

  <!-- æœ€è¿‘æ“ä½œ -->
  <view class="section">
    <view class="section-title">æœ€è¿‘æ“ä½œ</view>
    <view class="card">
      <view wx:if="{{recentHistory.length > 0}}">
        <view class="history-item" wx:for="{{recentHistory}}" wx:key="_id">
          <view class="history-icon {{item.type === 'in' ? 'bg-success' : 'bg-warning'}}">
            {{item.type === 'in' ? '+' : '-'}}
          </view>
          <view class="history-info">
            <text class="history-name">{{item.goodsName}}</text>
            <text class="history-time">{{item.timeStr}}</text>
          </view>
          <view class="history-action">
            <text class="tag {{item.type === 'in' ? 'tag-success' : 'tag-warning'}}">
              {{item.type === 'in' ? 'å…¥åº“' : 'å‡ºåº“'}}
            </text>
          </view>
        </view>
      </view>
      <view wx:else class="empty">
        <text>æš‚æ— æ“ä½œè®°å½•</text>
      </view>
    </view>
  </view>

  <!-- è´§ç‰©åˆ—è¡¨ -->
  <view class="section">
    <view class="section-title">è´§ç‰©åˆ—è¡¨</view>
    <view wx:if="{{goodsList.length > 0}}">
      <view class="goods-card" wx:for="{{goodsList}}" wx:key="_id" style="display: block;">
        <view class="goods-info" bindtap="viewGoods" data-id="{{item._id || item.id}}">
          <view class="goods-name">{{item.name}}</view>
          <view class="goods-detail">
            <text class="tag tag-primary">{{item.location}}</text>
            <text class="goods-price">Â¥{{item.price}}</text>
          </view>
        </view>
        <view class="goods-right">
          <view class="goods-stock" bindtap="viewGoods" data-id="{{item._id || item.id}}">
            <text class="stock-num {{item.stock > 10 ? 'text-success' : (item.stock > 0 ? 'text-warning' : 'text-error')}}">
              {{item.stock}}
            </text>
            <text class="stock-label">åº“å­˜</text>
          </view>
          <view class="delete-btn" catchtap="deleteGoods" data-id="{{item._id || item.id}}" data-name="{{item.name}}">ğŸ—‘</view>
        </view>
      </view>
    </view>
    <view wx:else class="empty">
      <text>æš‚æ— è´§ç‰©ï¼Œè¯·å…ˆæ·»åŠ </text>
      <button class="btn btn-primary mt-20" bindtap="goToOperation">æ·»åŠ è´§ç‰©</button>
    </view>
  </view>
</view>
